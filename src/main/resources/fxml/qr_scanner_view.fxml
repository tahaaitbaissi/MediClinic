<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Font?>

<BorderPane xmlns="http://javafx.com/javafx/21" xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.mediclinic.controller.QRScannerController"
            style="-fx-background-color: #ecf0f1;">

    <top>
        <VBox style="-fx-background-color: #2980b9; -fx-padding: 20;">
            <Label text="Scanner QR Code - Verification Rendez-vous" textFill="white">
                <font>
                    <Font name="System Bold" size="24"/>
                </font>
            </Label>
            <Label text="Scannez le QR code du patient pour verifier son rendez-vous"
                   textFill="white" style="-fx-opacity: 0.9;">
                <font>
                    <Font size="12"/>
                </font>
                <VBox.margin>
                    <Insets top="5"/>
                </VBox.margin>
            </Label>
        </VBox>
    </top>

    <center>
        <ScrollPane fitToWidth="true" fitToHeight="true" style="-fx-background-color: transparent;">
            <VBox spacing="20" style="-fx-padding: 20;">

                <VBox spacing="10" style="-fx-background-color: white; -fx-padding: 20; -fx-background-radius: 5; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 2);">
                    <Label text="Etape 1: Selectionner l'image QR Code" style="-fx-font-weight: bold; -fx-font-size: 14px; -fx-text-fill: #2c3e50;"/>

                    <HBox spacing="10" alignment="CENTER_LEFT">
                        <Button fx:id="selectImageButton" text="Parcourir..." onAction="#handleSelectImage"
                                style="-fx-background-color: #3498db; -fx-text-fill: white; -fx-font-weight: bold; -fx-cursor: hand;"
                                prefWidth="150"/>
                        <Label text="Ou faites glisser une image ici" style="-fx-text-fill: #95a5a6; -fx-font-style: italic;"/>
                    </HBox>

                    <VBox alignment="CENTER" style="-fx-background-color: #f8f9fa; -fx-padding: 20; -fx-border-color: #dee2e6; -fx-border-width: 2; -fx-border-style: dashed; -fx-background-radius: 5;">
                        <ImageView fx:id="qrImageView" fitWidth="300" fitHeight="300" preserveRatio="true"/>
                    </VBox>
                </VBox>

                <VBox spacing="10" style="-fx-background-color: white; -fx-padding: 20; -fx-background-radius: 5; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 2);">
                    <Label text="Etape 2: Scanner et Verifier" style="-fx-font-weight: bold; -fx-font-size: 14px; -fx-text-fill: #2c3e50;"/>

                    <HBox spacing="10">
                        <Button fx:id="scanButton" text="Scanner QR Code" onAction="#handleScan"
                                style="-fx-background-color: #27ae60; -fx-text-fill: white; -fx-font-weight: bold; -fx-cursor: hand;"
                                prefWidth="150" disable="true"/>
                        <Button text="Reinitialiser" onAction="#handleReset"
                                style="-fx-background-color: #95a5a6; -fx-text-fill: white; -fx-cursor: hand;"
                                prefWidth="120"/>
                    </HBox>

                    <Separator/>

                    <Label fx:id="statusLabel" text="Selectionnez une image de QR code pour commencer"
                           wrapText="true" style="-fx-font-size: 12px; -fx-text-fill: #7f8c8d; -fx-padding: 10;"/>
                </VBox>

                <VBox fx:id="resultPane" spacing="15" visible="false"
                      style="-fx-background-color: white; -fx-padding: 20; -fx-background-radius: 5; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 2);">

                    <Label text="Informations du Rendez-vous" style="-fx-font-weight: bold; -fx-font-size: 16px; -fx-text-fill: #2c3e50;"/>

                    <Separator/>

                    <GridPane hgap="15" vgap="10">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="30"/>
                            <ColumnConstraints percentWidth="70"/>
                        </columnConstraints>

                        <Label text="Patient:" style="-fx-font-weight: bold; -fx-text-fill: #34495e;" GridPane.rowIndex="0" GridPane.columnIndex="0"/>
                        <Label fx:id="patientNameLabel" text="-" style="-fx-text-fill: #2c3e50; -fx-font-size: 13px;" GridPane.rowIndex="0" GridPane.columnIndex="1"/>

                        <Label text="Numero Dossier:" style="-fx-font-weight: bold; -fx-text-fill: #34495e;" GridPane.rowIndex="1" GridPane.columnIndex="0"/>
                        <Label fx:id="patientIdLabel" text="-" style="-fx-text-fill: #2c3e50; -fx-font-size: 13px;" GridPane.rowIndex="1" GridPane.columnIndex="1"/>

                        <Label text="Medecin:" style="-fx-font-weight: bold; -fx-text-fill: #34495e;" GridPane.rowIndex="2" GridPane.columnIndex="0"/>
                        <Label fx:id="doctorNameLabel" text="-" style="-fx-text-fill: #2c3e50; -fx-font-size: 13px;" GridPane.rowIndex="2" GridPane.columnIndex="1"/>

                        <Label text="Date et Heure:" style="-fx-font-weight: bold; -fx-text-fill: #34495e;" GridPane.rowIndex="3" GridPane.columnIndex="0"/>
                        <Label fx:id="appointmentDateLabel" text="-" style="-fx-text-fill: #2c3e50; -fx-font-size: 13px;" GridPane.rowIndex="3" GridPane.columnIndex="1"/>

                        <Label text="Statut:" style="-fx-font-weight: bold; -fx-text-fill: #34495e;" GridPane.rowIndex="4" GridPane.columnIndex="0"/>
                        <Label fx:id="appointmentStatusLabel" text="-" style="-fx-font-size: 13px;" GridPane.rowIndex="4" GridPane.columnIndex="1"/>

                        <Label text="Motif:" style="-fx-font-weight: bold; -fx-text-fill: #34495e;" GridPane.rowIndex="5" GridPane.columnIndex="0"/>
                        <Label fx:id="motifLabel" text="-" wrapText="true" style="-fx-text-fill: #2c3e50; -fx-font-size: 13px;" GridPane.rowIndex="5" GridPane.columnIndex="1"/>
                    </GridPane>

                    <Separator/>

                    <VBox spacing="5">
                        <Label text="Details Complets:" style="-fx-font-weight: bold; -fx-text-fill: #34495e;"/>
                        <TextArea fx:id="detailsTextArea" editable="false" wrapText="true" prefRowCount="8"
                                  style="-fx-control-inner-background: #f8f9fa; -fx-font-family: 'Courier New'; -fx-font-size: 11px;"/>
                    </VBox>

                    <Separator/>

                    <HBox spacing="10" alignment="CENTER">
                        <Button fx:id="confirmButton" text="Confirmer l'Arrivee du Patient" onAction="#handleConfirmArrival"
                                visible="false"
                                style="-fx-background-color: #27ae60; -fx-text-fill: white; -fx-font-weight: bold; -fx-font-size: 14px; -fx-cursor: hand; -fx-padding: 10 20;"
                                prefWidth="250"/>
                    </HBox>
                </VBox>

            </VBox>
        </ScrollPane>
    </center>

    <bottom>
        <HBox style="-fx-background-color: #34495e; -fx-padding: 10;" alignment="CENTER">
            <Label text="MediClinic - Systeme de Verification QR Code" textFill="white" style="-fx-font-size: 10px;"/>
        </HBox>
    </bottom>

</BorderPane>
